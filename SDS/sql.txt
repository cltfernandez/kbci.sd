
UPDATE		SPTELLER SET CASHSAV=SD.AMT
FROM		(SELECT		[USER],SUM(ISNULL(TRANCRE,0)) AMT
			FROM		SDTRAN
			WHERE		TRANDATE='09/26/2008' AND REVERSED='False' AND [USER]='MYRNA'
						AND (TRANCODE='NCS' OR TRANCODE='CSD')
			GROUP BY	[USER]) SD
WHERE SD.[USER]= SPTELLER.TNAME

UPDATE		SPTELLER SET  CRSAV=SD.AMT
FROM		(SELECT		[USER],SUM(ISNULL(TRANCRE,0)) AMT
			FROM		SDTRAN
			WHERE		TRANDATE='09/26/2008' AND REVERSED='False' AND [USER]='MYRNA'
						AND (TRANCODE='LCD' OR TRANCODE='NLD' OR TRANCODE='OUS')
			GROUP BY	[USER]) SD
WHERE SD.[USER]= SPTELLER.TNAME

UPDATE		SPTELLER SET   [WITH]=SD.AMT
FROM		(SELECT		[USER],SUM(ISNULL(TRANDEB,0)) AMT
			FROM		SDTRAN
			WHERE		TRANDATE='09/26/2008' AND REVERSED='False' AND [USER]='MYRNA'
						AND (TRANCODE='WD' OR TRANCODE='NWD')
			GROUP BY	[USER]) SD
WHERE SD.[USER]= SPTELLER.TNAME

UPDATE		SPTELLER SET   ADDLTD=SD.AMT
FROM		(SELECT		OTHUSER,SUM(ISNULL(OTHAMOUNT,0)) AMT FROM SDOTHERS
  			 WHERE		OTHDATE='09/26/2008' AND OTHUSER='MYRNA'
						AND OTHTYPE='A'	GROUP BY OTHUSER) SD
WHERE SD.OTHUSER = SPTELLER.TNAME

UPDATE		SPTELLER SET   CRCR=SD.AMT
FROM		(SELECT		OTHUSER,SUM(ISNULL(OTHAMOUNT,0)) AMT FROM SDOTHERS
  			 WHERE		OTHDATE='09/26/2008' AND OTHUSER='MYRNA'
						AND OTHTYPE='B'	GROUP BY OTHUSER) SD
WHERE SD.OTHUSER = SPTELLER.TNAME

UPDATE		SPTELLER SET   CRACC=SD.AMT,CHKENC=SD.AMT
FROM		(SELECT		OTHUSER,SUM(ISNULL(OTHAMOUNT,0)) AMT FROM SDOTHERS
  			 WHERE		OTHDATE='09/26/2008' AND OTHUSER='MYRNA'
						AND OTHTYPE='C'	GROUP BY OTHUSER) SD
WHERE SD.OTHUSER = SPTELLER.TNAME

UPDATE		SPTELLER SET   REF=SD.AMT
FROM		(SELECT		OTHUSER,SUM(ISNULL(OTHAMOUNT,0)) AMT FROM SDOTHERS
  			 WHERE		OTHDATE='09/26/2008' AND OTHUSER='MYRNA'
						AND OTHTYPE='D'	GROUP BY OTHUSER) SD
WHERE SD.OTHUSER = SPTELLER.TNAME

UPDATE		SPTELLER SET   EMER=SD.AMT
FROM		(SELECT		OTHUSER,SUM(ISNULL(OTHAMOUNT,0)) AMT FROM SDOTHERS
  			 WHERE		OTHDATE='09/26/2008' AND OTHUSER='MYRNA'
						AND OTHTYPE='E'	GROUP BY OTHUSER) SD
WHERE SD.OTHUSER = SPTELLER.TNAME

UPDATE		SPTELLER SET CTFNAME1='',CTFNAME2='',CTFNAME3='',CTFAMT1=0,CTFAMT2=0,CTFAMT3=0,
						 CTTNAME1='',CTTNAME2='',CTTNAME3='',CTTAMT1=0,CTTAMT2=0,CTTAMT3=0
WHERE		TNAME='MYRNA'						 



UPDATE		SPTELLER
SET		ADDMREQ=X.ADDMREQ
FROM		(SELECT ADDLREQ + (SELECT ISNULL(SUM(REQAMT),0) FROM CASHREQ WHERE REQNAME='myrna') ADDMREQ
		 FROM SPTELLER WHERE TNAME='MYRNA') X
WHERE		TNAME='MYRNA'

UPDATE 		SPTELLER
SET		ADDCASH=X.ADDCASH,ADDCHECKS=X.ADDCHECKS,ADDTOTAL=X.ADDTOTAL,CTTCEND=X.CTTCEND,CHKDEP=X.CHKDEP
FROM		(SELECT (ISNULL(CASHB,0)+ISNULL(COCIB,0)+ISNULL(ADDMREQ,0)+ISNULL(CASHSAV,0)+
		 ISNULL(CASHOR,0)+ISNULL(ADDLTD,0)+ISNULL(CTFAMT1,0)+ISNULL(CTFAMT2,0)+ISNULL(CTFAMT3,0)) ADDCASH,
		 (ISNULL(CRSAV,0)+ISNULL(CRORO,0)+ISNULL(CRACC,0)+ISNULL(CRCR,0)) ADDCHECKS,
		 (ISNULL(ADDCASH,0)+ISNULL(ADDCHECKS,0)) ADDTOTAL,TCCOUNT AS CTTCEND,
		 (COCIB+CRSAV+CRORO+CRACC+CRCR-COCI) CHKDEP FROM SPTELLER WHERE	TNAME='MYRNA') X
WHERE 		TNAME='MYRNA'

UPDATE		SPTELLER
SET		TOTDISB=X.XTOTDISB,CBALEND=X.XBALEND
FROM		(SELECT TNAME TN,(DIB+REF+[WITH]+CHKENC+CTTAMT1+CTTAMT2+CTTAMT3+COCI+CHKDEP+EMER) XTOTDISB,
		(ADDTOTAL+(DIB+REF+[WITH]+CHKENC+CTTAMT1+CTTAMT2+CTTAMT3+COCI+CHKDEP+EMER))XBALEND
		FROM SPTELLER WHERE TNAME='MYRNA') X
WHERE 		TNAME=X.TN

UPDATE		SPTELLER
SET		[OVER]= X.OVR
FROM		(SELECT TNAME TN,(CTTCEND-CBALEND) OVR FROM SPTELLER WHERE TNAME='MYRNA') X
WHERE		TNAME=X.TN


UPDATE SDMASTER SET ACCTFLOATS=SC.ACCTFLOATS
FROM		(SELECT DISTINCT		SK.ACCTNUM,(CASE WHEN (SK.CHKNDAYS-1)<1 THEN  SM.ACCTFLOATS-DAMT.AMT ELSE SM.ACCTFLOATS END) ACCTFLOATS
			 FROM				SDCHECK SK INNER JOIN SDMASTER SM
								ON SK.ACCTNUM=SM.ACCTNO
									RIGHT JOIN  (SELECT ACCTNUM,SUM(CHKAMT) AMT FROM	SDCHECK SK WHERE SK.CHKNDAYS > 0 AND SK.[USER]='MYRNA'  AND (SK.CHKNDAYS-1)=0 GROUP BY ACCTNUM) DAMT
									ON  SK.ACCTNUM=DAMT.ACCTNUM
			 WHERE SK.CHKNDAYS > 0 AND SK.[USER]='MYRNA') SC
WHERE SDMASTER.ACCTNO=SC.ACCTNUM			
			 
UPDATE	SDCHECK SET  CHKNDAYS=SC.CHKNDAYS,CHKSTAT=SC.CHKSTAT,CHKCDATE=SC.CHKCDATE
FROM	(SELECT SDCHECK_ID,(CHKNDAYS -1) CHKNDAYS,(CASE WHEN (CHKNDAYS-1)<1 THEN 'CLE' ELSE CHKSTAT END) CHKSTAT,
		 (CASE WHEN (CHKNDAYS-1)<1 THEN '01/01/1900' ELSE CHKCDATE END) CHKCDATE FROM SDCHECK WHERE CHKNDAYS > 0 AND [USER]='MYRNA') SC
WHERE	SDCHECK.SDCHECK_ID=SC.SDCHECK_ID
Go